package szarch;

import java.sql.ResultSet;
import java.sql.SQLException;

public class User implements Utility<User>{

	private java.lang.Integer id;
	private String name;
	private String password;
	private int role_id;
	
	public int get_id()			{ return id; }
	public String get_name() 	{ return name; }
	public String get_pw()		{ return password; }
	public int get_role_id()	{ return role_id; }
	
	//public void set_id(int new_id)				{ id = new_id; }
	//ID is a DB value, modifies it could be make errors
	public void set_name(String new_name) 		{ name = new_name; }
	public void set_pw(String new_pw)			{ password = new_pw; }
	public void set_role_id(int new_role_id) 	{ role_id = new_role_id; }
	
	
	public User(){
		this.id = null;
		this.name = null;
		this.password = null;
		this.role_id = 0;	
	}
	
	@Override
	public int add(User user) {
		
		int user_id = 0;
		
		try {
			String query = "INSERT INTO user VALUES (null,?,?,?)";
			
			java.sql.PreparedStatement stmt = conn.prepareStatement(query);
			
			stmt.setString(1, user.get_name());
			stmt.setString(2, user.get_pw());
			stmt.setInt(3, user.get_role_id());
			
			stmt.execute();
			
			// Query the ID of the newly added image.
			query = "SELECT * FROM user WHERE name = ?";	
			stmt = conn.prepareStatement(query);
			stmt.setString(1, name);
			ResultSet r = stmt.executeQuery();
			r.next();
			user_id = r.getInt("id");
	
		} catch (SQLException ex) {
			   System.out.println("SQLException: " + ex.getMessage());
			   System.out.println("SQLState: " + ex.getSQLState());
			   System.out.println("VendorError: " + ex.getErrorCode());
		}
		
		return user_id;
	}
}
